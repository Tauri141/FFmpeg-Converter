<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Графический интерфейс для FFmpeg</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-select, .form-input, .form-checkbox {
            background-color: #374151; /* gray-700 */
            border-color: #4b5563; /* gray-600 */
        }
        .form-select:focus, .form-input:focus, .form-checkbox:focus {
            --tw-ring-color: #3b82f6; /* blue-500 */
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .form-checkbox {
            color: #3b82f6;
        }
        optgroup {
            font-weight: bold;
            background-color: #1f2937; /* gray-800 */
            color: #9ca3af; /* gray-400 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-white">FFmpeg Конвертер</h1>
            <p class="text-gray-400 mt-2">Создайте команду для конвертации видео и аудио файлов</p>
        </div>

        <!-- Main Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Input/Output Section -->
            <div class="space-y-4 bg-gray-900/50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold border-b border-gray-700 pb-2 mb-4">1. Файлы</h3>
                <div>
                    <label for="inputFile" class="block mb-2 text-sm font-medium text-gray-300">Исходный файл (полный путь)</label>
                    <input type="text" id="inputFile" class="form-input w-full rounded-lg p-2.5" placeholder='"C:\Users\Videos\input.mp4"'>
                </div>
                <div>
                    <label for="outputFile" class="block mb-2 text-sm font-medium text-gray-300">Выходной файл (полный путь)</label>
                    <input type="text" id="outputFile" class="form-input w-full rounded-lg p-2.5" placeholder='"D:\Converted\output.mkv"'>
                </div>
            </div>

            <!-- Conversion Parameters Section -->
            <div class="space-y-4 bg-gray-900/50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold border-b border-gray-700 pb-2 mb-4">2. Параметры конвертации</h3>
                <!-- Video Options -->
                <div>
                    <label for="videoCodec" class="block mb-2 text-sm font-medium text-gray-300">Видео кодек</label>
                    <select id="videoCodec" class="form-select w-full rounded-lg p-2.5">
                        <optgroup label="Программные кодеки (CPU)">
                            <option value="libx264">H.264 (libx264)</option>
                            <option value="libx265">H.265 (libx265)</option>
                            <option value="libvpx-vp9">VP9 (libvpx-vp9)</option>
                        </optgroup>
                        <optgroup label="Аппаратное ускорение (GPU)">
                            <option value="h264_nvenc">H.264 (NVIDIA NVENC)</option>
                            <option value="hevc_nvenc">H.265 (NVIDIA NVENC)</option>
                            <option value="h264_qsv">H.264 (Intel QSV)</option>
                            <option value="hevc_qsv">H.265 (Intel QSV)</option>
                            <option value="h264_amf">H.264 (AMD AMF)</option>
                            <option value="hevc_amf">H.265 (AMD AMF)</option>
                        </optgroup>
                        <optgroup label="Специальные">
                            <option value="copy">Копировать (без перекодирования)</option>
                            <option value="none">Удалить видео</option>
                        </optgroup>
                    </select>
                    <p class="text-xs text-gray-500 mt-2">Для аппаратного ускорения требуются совместимая видеокарта и установленные драйверы.</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="videoBitrate" class="block mb-2 text-sm font-medium text-gray-300">Видео битрейт (kbps)</label>
                        <input type="number" id="videoBitrate" class="form-input w-full rounded-lg p-2.5" placeholder="15000" value="15000">
                    </div>
                    <div>
                        <label for="resolutionW" class="block mb-2 text-sm font-medium text-gray-300">Ширина</label>
                        <input type="number" id="resolutionW" class="form-input w-full rounded-lg p-2.5" placeholder="1920">
                    </div>
                    <div>
                        <label for="aspectRatio" class="block mb-2 text-sm font-medium text-gray-300">Соотношение сторон</label>
                        <select id="aspectRatio" class="form-select w-full rounded-lg p-2.5">
                            <option value="source">Исходное</option>
                            <option value="16:9">16:9</option>
                            <option value="4:3">4:3</option>
                            <option value="1:1">1:1 (Квадрат)</option>
                            <option value="2.35:1">2.35:1 (Кино)</option>
                        </select>
                    </div>
                    <div>
                        <label for="resolutionH" class="block mb-2 text-sm font-medium text-gray-300">Высота</label>
                        <input type="number" id="resolutionH" class="form-input w-full rounded-lg p-2.5" placeholder="1080">
                    </div>
                </div>

                <!-- Audio Options -->
                <div class="pt-4 mt-4 border-t border-gray-700">
                    <h4 class="text-lg font-semibold mb-3">Аудио дорожки</h4>
                    <div id="audioTracksContainer" class="space-y-5">
                        <!-- Audio track groups will be injected here by JS -->
                    </div>
                    <button id="addAudioTrackBtn" class="mt-4 text-sm bg-blue-600/50 hover:bg-blue-600/80 text-white font-semibold py-2 px-4 rounded-lg w-full transition-colors">
                        Добавить аудио дорожку
                    </button>
                </div>

                 <!-- Video Filters -->
                <div class="pt-4 mt-4 border-t border-gray-700">
                     <h4 class="text-base font-medium text-gray-300 mb-2">Видео фильтры</h4>
                     <div class="space-y-2">
                         <label class="flex items-center space-x-3 cursor-pointer">
                             <input type="checkbox" id="deinterlace" class="form-checkbox h-5 w-5 rounded bg-gray-700 border-gray-600 text-blue-600 focus:ring-blue-500">
                             <span class="text-sm text-gray-300">Деинтерлейс (yadif)</span>
                         </label>
                     </div>
                </div>
            </div>
        </div>

        <!-- Action Button -->
        <div class="flex justify-center pt-4">
            <button id="generateBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-800">
                Сгенерировать команду
            </button>
        </div>

        <!-- Output Section -->
        <div id="outputSection" class="hidden pt-6">
            <h3 class="text-lg font-semibold mb-2">3. Готовая команда</h3>
            <div class="relative bg-gray-900 rounded-lg p-4 font-mono text-sm text-green-400 overflow-x-auto">
                <code id="outputCommand"></code>
                <button id="copyBtn" class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-1 px-3 rounded-md text-xs">
                    Копировать
                </button>
            </div>
            <p id="copy-message" class="text-center text-sm text-green-500 mt-2 opacity-0 transition-opacity duration-300">Команда скопирована в буфер обмена!</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const inputFileEl = document.getElementById('inputFile');
        const outputFileEl = document.getElementById('outputFile');
        const videoCodecEl = document.getElementById('videoCodec');
        const videoBitrateEl = document.getElementById('videoBitrate');
        const resolutionWEl = document.getElementById('resolutionW');
        const resolutionHEl = document.getElementById('resolutionH');
        const aspectRatioEl = document.getElementById('aspectRatio');
        const deinterlaceEl = document.getElementById('deinterlace');
        const generateBtn = document.getElementById('generateBtn');
        const outputSection = document.getElementById('outputSection');
        const outputCommandEl = document.getElementById('outputCommand');
        const copyBtn = document.getElementById('copyBtn');
        const copyMessage = document.getElementById('copy-message');
        const audioTracksContainer = document.getElementById('audioTracksContainer');
        const addAudioTrackBtn = document.getElementById('addAudioTrackBtn');

        const languages = [
            { code: 'rus', name: 'Russian' }, { code: 'ukr', name: 'Ukrainian' }, { code: 'eng', name: 'English' }, { code: 'pol', name: 'Polish' },
            { code: 'separator', name: '──────────' },
            { code: 'aar', name: 'Afar' }, { code: 'abk', name: 'Abkhazian' }, { code: 'ave', name: 'Avestan' }, { code: 'afr', name: 'Afrikaans' }, { code: 'aka', name: 'Akan' }, { code: 'amh', name: 'Amharic' }, { code: 'arg', name: 'Aragonese' }, { code: 'ara', name: 'Arabic' }, { code: 'asm', name: 'Assamese' }, { code: 'ava', name: 'Avaric' }, { code: 'aym', name: 'Aymara' }, { code: 'aze', name: 'Azerbaijani' }, { code: 'bak', name: 'Bashkir' }, { code: 'bel', name: 'Belarusian' }, { code: 'bul', name: 'Bulgarian' }, { code: 'bih', name: 'Bihari languages' }, { code: 'bis', name: 'Bislama' }, { code: 'bam', name: 'Bambara' }, { code: 'ben', name: 'Bengali' }, { code: 'bod', name: 'Tibetan' }, { code: 'bre', name: 'Breton' }, { code: 'bos', name: 'Bosnian' }, { code: 'cat', name: 'Catalan; Valencian' }, { code: 'che', name: 'Chechen' }, { code: 'cha', name: 'Chamorro' }, { code: 'cos', name: 'Corsican' }, { code: 'cre', name: 'Cree' }, { code: 'ces', name: 'Czech' }, { code: 'chu', name: 'Church Slavic' }, { code: 'chv', name: 'Chuvash' }, { code: 'cym', name: 'Welsh' }, { code: 'dan', name: 'Danish' }, { code: 'deu', name: 'German' }, { code: 'div', name: 'Divehi; Dhivehi; Maldivian' }, { code: 'dzo', name: 'Dzongkha' }, { code: 'ewe', name: 'Ewe' }, { code: 'ell', name: 'Greek, Modern (1453-)' }, { code: 'epo', name: 'Esperanto' }, { code: 'spa', name: 'Spanish; Castilian' }, { code: 'est', name: 'Estonian' }, { code: 'eus', name: 'Basque' }, { code: 'fas', name: 'Persian' }, { code: 'ful', name: 'Fulah' }, { code: 'fin', name: 'Finnish' }, { code: 'fij', name: 'Fijian' }, { code: 'fao', name: 'Faroese' }, { code: 'fra', name: 'French' }, { code: 'fry', name: 'Western Frisian' }, { code: 'gle', name: 'Irish' }, { code: 'gla', name: 'Gaelic; Scottish Gaelic' }, { code: 'glg', name: 'Galician' }, { code: 'grn', name: 'Guarani' }, { code: 'guj', name: 'Gujarati' }, { code: 'glv', name: 'Manx' }, { code: 'hau', name: 'Hausa' }, { code: 'heb', name: 'Hebrew' }, { code: 'hin', name: 'Hindi' }, { code: 'hmo', name: 'Hiri Motu' }, { code: 'hrv', name: 'Croatian' }, { code: 'hat', name: 'Haitian; Haitian Creole' }, { code: 'hun', name: 'Hungarian' }, { code: 'hye', name: 'Armenian' }, { code: 'her', name: 'Herero' }, { code: 'ina', name: 'Interlingua (International Auxiliary Language Association)' }, { code: 'ind', name: 'Indonesian' }, { code: 'ile', name: 'Interlingue; Occidental' }, { code: 'ibo', name: 'Igbo' }, { code: 'iii', name: 'Sichuan Yi; Nuosu' }, { code: 'ipk', name: 'Inupiaq' }, { code: 'ido', name: 'Ido' }, { code: 'isl', name: 'Icelandic' }, { code: 'ita', name: 'Italian' }, { code: 'iku', name: 'Inuktitut' }, { code: 'jpn', name: 'Japanese' }, { code: 'jav', name: 'Javanese' }, { code: 'kat', name: 'Georgian' }, { code: 'kon', name: 'Kongo' }, { code: 'kik', name: 'Kikuyu; Gikuyu' }, { code: 'kua', name: 'Kuanyama; Kwanyama' }, { code: 'kaz', name: 'Kazakh' }, { code: 'kal', name: 'Kalaallisut; Greenlandic' }, { code: 'khm', name: 'Central Khmer' }, { code: 'kan', name: 'Kannada' }, { code: 'kor', name: 'Korean' }, { code: 'kau', name: 'Kanuri' }, { code: 'kas', name: 'Kashmiri' }, { code: 'kur', name: 'Kurdish' }, { code: 'kom', name: 'Komi' }, { code: 'cor', name: 'Cornish' }, { code: 'kir', name: 'Kirghiz; Kyrgyz' }, { code: 'lat', name: 'Latin' }, { code: 'ltz', name: 'Luxembourgish; Letzeburgesch' }, { code: 'lug', name: 'Ganda' }, { code: 'lim', name: 'Limburgan; Limburger; Limburgish' }, { code: 'lin', name: 'Lingala' }, { code: 'lao', name: 'Lao' }, { code: 'lit', name: 'Lithuanian' }, { code: 'lub', name: 'Luba-Katanga' }, { code: 'lav', name: 'Latvian' }, { code: 'mlg', name: 'Malagasy' }, { code: 'mah', name: 'Marshallese' }, { code: 'mri', name: 'Maori' }, { code: 'mkd', name: 'Macedonian' }, { code: 'mal', name: 'Malayalam' }, { code: 'mon', name: 'Mongolian' }, { code: 'mar', name: 'Marathi' }, { code: 'msa', name: 'Malay' }, { code: 'mlt', name: 'Maltese' }, { code: 'mya', name: 'Burmese' }, { code: 'nau', name: 'Nauru' }, { code: 'nob', name: 'Bokmål, Norwegian; Norwegian Bokmål' }, { code: 'nde', name: 'Ndebele, North; North Ndebele' }, { code: 'nep', name: 'Nepali' }, { code: 'ndo', name: 'Ndonga' }, { code: 'nld', name: 'Dutch; Flemish' }, { code: 'nno', name: 'Norwegian Nynorsk; Nynorsk, Norwegian' }, { code: 'nor', name: 'Norwegian' }, { code: 'nbl', name: 'Ndebele, South; South Ndebele' }, { code: 'nav', name: 'Navajo; Navaho' }, { code: 'nya', name: 'Chichewa; Chewa; Nyanja' }, { code: 'oci', name: 'Occitan (post 1500)' }, { code: 'oji', name: 'Ojibwa' }, { code: 'orm', name: 'Oromo' }, { code: 'ori', name: 'Oriya' }, { code: 'oss', name: 'Ossetian; Ossetic' }, { code: 'pan', name: 'Panjabi; Punjabi' }, { code: 'pli', name: 'Pali' }, { code: 'pus', name: 'Pushto; Pashto' }, { code: 'por', name: 'Portuguese' }, { code: 'que', name: 'Quechua' }, { code: 'roh', name: 'Romansh' }, { code: 'run', name: 'Rundi' }, { code: 'ron', name: 'Romanian; Moldavian; Moldovan' }, { code: 'kin', name: 'Kinyarwanda' }, { code: 'san', name: 'Sanskrit' }, { code: 'srd', name: 'Sardinian' }, { code: 'snd', name: 'Sindhi' }, { code: 'sme', name: 'Northern Sami' }, { code: 'sag', name: 'Sango' }, { code: 'sin', name: 'Sinhala; Sinhalese' }, { code: 'slk', name: 'Slovak' }, { code: 'slv', name: 'Slovenian' }, { code: 'smo', name: 'Samoan' }, { code: 'sna', name: 'Shona' }, { code: 'som', name: 'Somali' }, { code: 'sqi', name: 'Albanian' }, { code: 'srp', name: 'Serbian' }, { code: 'ssw', name: 'Swati' }, { code: 'sot', name: 'Sotho, Southern' }, { code: 'sun', name: 'Sundanese' }, { code: 'swe', name: 'Swedish' }, { code: 'swa', name: 'Swahili' }, { code: 'tam', name: 'Tamil' }, { code: 'tel', name: 'Telugu' }, { code: 'tgk', name: 'Tajik' }, { code: 'tha', name: 'Thai' }, { code: 'tir', name: 'Tigrinya' }, { code: 'tuk', name: 'Turkmen' }, { code: 'tgl', name: 'Tagalog' }, { code: 'tsn', name: 'Tswana' }, { code: 'ton', name: 'Tonga (Tonga Islands)' }, { code: 'tur', name: 'Turkish' }, { code: 'tso', name: 'Tsonga' }, { code: 'tat', name: 'Tatar' }, { code: 'twi', name: 'Twi' }, { code: 'tah', name: 'Tahitian' }, { code: 'uig', name: 'Uighur; Uyghur' }, { code: 'urd', name: 'Urdu' }, { code: 'uzb', name: 'Uzbek' }, { code: 'ven', name: 'Venda' }, { code: 'vie', name: 'Vietnamese' }, { code: 'vol', name: 'Volapük' }, { code: 'wln', name: 'Walloon' }, { code: 'wol', name: 'Wolof' }, { code: 'xho', name: 'Xhosa' }, { code: 'yid', name: 'Yiddish' }, { code: 'yor', name: 'Yoruba' }, { code: 'zha', name: 'Zhuang; Chuang' }, { code: 'zho', name: 'Chinese' }, { code: 'zul', name: 'Zulu' }
        ];

        let audioTrackIdCounter = 0;

        function updateAudioTrackTitles() {
            const allTracks = audioTracksContainer.querySelectorAll('.audio-track-group');
            allTracks.forEach((trackEl, index) => {
                const titleEl = trackEl.querySelector('.track-title');
                if (titleEl) {
                    titleEl.textContent = `Выходная аудио дорожка №${index + 1}`;
                }
            });
        }

        function createAudioTrackElement(isFirst = false) {
            const trackId = audioTrackIdCounter++;
            const trackDiv = document.createElement('div');
            trackDiv.className = 'audio-track-group bg-gray-800/50 p-4 rounded-lg space-y-3 relative';
            trackDiv.dataset.id = trackId;

            const langOptions = languages.map(lang => {
                if (lang.code === 'separator') return `<option disabled>${lang.name}</option>`;
                const selected = (isFirst && lang.code === 'rus') ? 'selected' : '';
                return `<option value="${lang.code}" ${selected}>${lang.name}</option>`;
            }).join('');

            let sourceTrackOptions = '';
            const currentTrackCount = audioTracksContainer.children.length;
            for (let i = 1; i <= 16; i++) {
                const selected = (currentTrackCount + 1 === i) ? 'selected' : '';
                sourceTrackOptions += `<option value="${i}" ${selected}>${i}</option>`;
            }

            trackDiv.innerHTML = `
                <h5 class="track-title text-base font-semibold text-blue-400 mb-2"></h5>
                <div class="grid grid-cols-2 gap-x-4 gap-y-3">
                    <div>
                        <label for="audio-index-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">Исходная дорожка</label>
                        <select id="audio-index-${trackId}" class="audio-index form-select w-full rounded-md p-2 text-sm">${sourceTrackOptions}</select>
                    </div>
                    <div>
                        <label for="audio-codec-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">Аудио кодек</label>
                        <select id="audio-codec-${trackId}" class="audio-codec form-select w-full rounded-md p-2 text-sm">
                            <option value="aac">AAC</option>
                            <option value="ac3">AC3</option>
                            <option value="libmp3lame" selected>MP3</option>
                            <option value="opus">Opus</option>
                            <option value="copy">Копировать</option>
                            <option value="none">Удалить аудио</option>
                        </select>
                    </div>
                    <div>
                        <label for="audio-channels-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">Каналы</label>
                        <select id="audio-channels-${trackId}" class="audio-channels form-select w-full rounded-md p-2 text-sm">
                            <option value="2" selected>Stereo 2.0</option>
                            <option value="1">Mono</option>
                            <option value="6">5.1 Surround</option>
                        </select>
                    </div>
                    <div>
                        <label for="audio-bitrate-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">Битрейт (kbps)</label>
                        <input type="number" id="audio-bitrate-${trackId}" placeholder="320" value="320" class="audio-bitrate form-input w-full rounded-md p-2 text-sm">
                    </div>
                    <div class="col-span-2">
                        <label for="audio-lang-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">Язык дорожки</label>
                        <select id="audio-lang-${trackId}" class="audio-lang form-select w-full rounded-md p-2 text-sm">${langOptions}</select>
                    </div>
                    <div class="col-span-2">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="audio-loudnorm-${trackId}" class="audio-loudnorm form-checkbox h-4 w-4 rounded">
                            <span class="text-sm text-gray-300">Нормализация громкости (loudnorm)</span>
                        </label>
                    </div>
                </div>
                ${!isFirst ? `<button class="remove-track-btn absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-xs">&times;</button>` : ''}
            `;
            
            if (!isFirst) {
                trackDiv.querySelector('.remove-track-btn').addEventListener('click', () => {
                    trackDiv.remove();
                    updateAudioTrackTitles();
                });
            }

            return trackDiv;
        }
        
        addAudioTrackBtn.addEventListener('click', () => {
            audioTracksContainer.appendChild(createAudioTrackElement());
            updateAudioTrackTitles();
        });

        // Initialize with one audio track
        document.addEventListener('DOMContentLoaded', () => {
            audioTracksContainer.appendChild(createAudioTrackElement(true));
            updateAudioTrackTitles();
        });


        // Generate command on button click
        generateBtn.addEventListener('click', () => {
            const inputFile = inputFileEl.value.trim();
            const outputFile = outputFileEl.value.trim();

            if (!inputFile || !outputFile) {
                alert('Пожалуйста, укажите исходный и выходной файлы.');
                return;
            }

            // --- Command construction logic ---
            let command = `ffmpeg -i ${inputFile}`;
            
            // Video mapping and codec
            const videoCodec = videoCodecEl.value;
            let videoParams = '';
            if (videoCodec !== 'none') {
                command += ' -map 0:v:0?';
                videoParams += ` -c:v:0 ${videoCodec}`;
                if (videoCodec !== 'copy') {
                    const videoBitrate = videoBitrateEl.value.trim();
                    if (videoBitrate) {
                        videoParams += ` -b:v:0 ${videoBitrate}k`;
                    }
                    if (videoCodec === 'libx264') {
                        videoParams += ' -profile:v:0 high -pix_fmt yuv420p -level 4.1 -preset medium';
                    } else if (videoCodec === 'libx265') {
                        videoParams += ' -preset medium';
                    }
                }
                const aspectRatio = aspectRatioEl.value;
                if (aspectRatio !== 'source') {
                    videoParams += ` -aspect:v:0 ${aspectRatio}`;
                }

            } else {
                command += ' -vn';
            }

            // Audio Tracks
            const audioTrackElements = audioTracksContainer.querySelectorAll('.audio-track-group');
            let audioParams = '';
            let audioOutputIndex = 0;
            audioTrackElements.forEach(trackEl => {
                const audioIndexFromUI = parseInt(trackEl.querySelector('.audio-index').value, 10);
                
                if (isNaN(audioIndexFromUI) || audioIndexFromUI < 1) return;
                
                const audioIndexForCommand = audioIndexFromUI - 1;
                const audioCodec = trackEl.querySelector('.audio-codec').value;
                
                if (audioCodec === 'none') return;

                command += ` -map 0:a:${audioIndexForCommand}?`;
                
                const audioChannels = trackEl.querySelector('.audio-channels').value;
                const audioBitrate = trackEl.querySelector('.audio-bitrate').value.trim();
                const audioLang = trackEl.querySelector('.audio-lang').value;
                const loudnormChecked = trackEl.querySelector('.audio-loudnorm').checked;

                audioParams += ` -c:a:${audioOutputIndex} ${audioCodec}`;
                
                if (audioCodec !== 'copy') {
                    audioParams += ` -ac:a:${audioOutputIndex} ${audioChannels}`;
                    
                    if (audioBitrate) {
                        audioParams += ` -b:a:${audioOutputIndex} ${audioBitrate}k`;
                    }
                }

                if (audioLang) {
                    audioParams += ` -metadata:s:a:${audioOutputIndex} language=${audioLang}`;
                }

                if (loudnormChecked && audioCodec !== 'copy') {
                    audioParams += ` -af:a:${audioOutputIndex} loudnorm`;
                }

                audioOutputIndex++;
            });

            if (audioOutputIndex === 0) {
                command += ' -an';
            }
            
            // Video Filters
            const videoFilters = [];
            if (videoCodec !== 'copy' && videoCodec !== 'none') {
                if (deinterlaceEl.checked) videoFilters.push('yadif');
                
                const width = resolutionWEl.value.trim();
                const height = resolutionHEl.value.trim();
                if (width || height) {
                     videoFilters.push(`scale=${width || -2}:${height || -2}`);
                }
            }
            
            if (videoFilters.length > 0) {
                videoParams += ` -vf "${videoFilters.join(',')}"`;
            }

            // Add params to main command
            command += videoParams + audioParams;
            
            // Map subtitles
            command += ' -map 0:s? -c:s copy';

            // Output file
            command += ` -y ${outputFile}`;
            
            outputCommandEl.textContent = command;
            outputSection.classList.remove('hidden');
        });

        // Copy to clipboard functionality
        copyBtn.addEventListener('click', () => {
            const commandText = outputCommandEl.textContent;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = commandText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            copyMessage.style.opacity = '1';
            setTimeout(() => { copyMessage.style.opacity = '0'; }, 2000);
        });
    </script>
</body>
</html>

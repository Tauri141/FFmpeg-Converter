<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg GUI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-select, .form-input, .form-checkbox {
            background-color: #374151; /* gray-700 */
            border-color: #4b5563; /* gray-600 */
        }
        .form-select:focus, .form-input:focus, .form-checkbox:focus {
            --tw-ring-color: #3b82f6; /* blue-500 */
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .form-checkbox {
            color: #3b82f6;
        }
        optgroup {
            font-weight: bold;
            background-color: #1f2937; /* gray-800 */
            color: #9ca3af; /* gray-400 */
        }
        .tab-active {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        .tab-inactive {
            border-color: transparent;
            color: #9ca3af;
        }
        code {
            white-space: pre;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6 relative">
        <!-- Language Selector -->
        <div class="absolute top-4 right-6">
            <select id="languageSelector" class="form-select text-sm rounded-md p-1">
                <option value="ru">Русский</option>
                <option value="uk">Українська</option>
                <option value="en">English</option>
            </select>
        </div>

        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-white" data-translate-key="mainTitle"></h1>
            <p class="text-gray-400 mt-2" data-translate-key="subTitle"></p>
        </div>
        
        <!-- Mode Toggle -->
        <div class="flex justify-center items-center my-4">
            <span class="mr-3 text-sm font-medium text-gray-300" data-translate-key="singleModeLabel"></span>
            <label for="mode-toggle" class="inline-flex relative items-center cursor-pointer">
                <input type="checkbox" value="" id="mode-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
            </label>
            <span class="ml-3 text-sm font-medium text-gray-300" data-translate-key="batchModeLabel"></span>
        </div>

        <!-- Main Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Input/Output Section -->
            <div class="space-y-4 bg-gray-900/50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold border-b border-gray-700 pb-2 mb-4" data-translate-key="filesTitle"></h3>
                <!-- Single File Mode -->
                <div id="singleFileMode">
                    <div>
                        <label for="inputFile" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="inputFileLabel"></label>
                        <input type="text" id="inputFile" class="form-input w-full rounded-lg p-2.5" data-translate-key-placeholder="inputFilePlaceholder">
                    </div>
                    <div>
                        <label for="outputFile" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="outputFileLabel"></label>
                        <input type="text" id="outputFile" class="form-input w-full rounded-lg p-2.5" data-translate-key-placeholder="outputFilePlaceholder">
                    </div>
                </div>
                <!-- Batch Mode -->
                <div id="batchMode" class="hidden space-y-4">
                     <div>
                        <label for="inputFolder" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="inputFolderLabel"></label>
                        <input type="text" id="inputFolder" class="form-input w-full rounded-lg p-2.5" placeholder="C:\Users\Videos\Input">
                    </div>
                    <div>
                        <label for="outputFolder" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="outputFolderLabel"></label>
                        <input type="text" id="outputFolder" class="form-input w-full rounded-lg p-2.5" placeholder="D:\Converted">
                    </div>
                     <div>
                        <label for="fileTypes" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="fileTypesLabel"></label>
                        <input type="text" id="fileTypes" class="form-input w-full rounded-lg p-2.5" value="*.mp4, *.mov, *.mkv, *.mp3, *.ac3, *.aac">
                    </div>
                    <div>
                        <label for="outputFormat" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="outputFormatLabel"></label>
                        <select id="outputFormat" class="form-select w-full rounded-lg p-2.5">
                            <option value="mkv">mkv</option>
                            <option value="mp4">mp4</option>
                            <option value="mov">mov</option>
                            <option value="mp3">mp3</option>
                            <option value="ac3">ac3</option>
                            <option value="aac">aac</option>
                        </select>
                    </div>
                </div>
                <!-- Trimming Section -->
                <div id="trimmingSection" class="pt-4 mt-4 border-t border-gray-700">
                    <h4 class="text-base font-medium text-gray-300 mb-2" data-translate-key="trimTitle"></h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="trimStart" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="trimStartLabel"></label>
                            <input type="text" id="trimStart" class="form-input w-full rounded-lg p-2.5" placeholder="00:00:00">
                        </div>
                        <div>
                            <label for="trimEnd" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="trimEndLabel"></label>
                            <input type="text" id="trimEnd" class="form-input w-full rounded-lg p-2.5" placeholder="00:00:00">
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2" data-translate-key="trimNotice"></p>
                </div>
            </div>

            <!-- Conversion Parameters Section -->
            <div class="space-y-4 bg-gray-900/50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold border-b border-gray-700 pb-2 mb-4" data-translate-key="paramsTitle"></h3>
                <!-- Video Options -->
                <div>
                    <label for="videoCodec" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="videoCodecLabel"></label>
                    <select id="videoCodec" class="form-select w-full rounded-lg p-2.5">
                        <optgroup data-translate-key-label="cpuCodecsLabel">
                            <option value="libx264">H.264 (libx264)</option>
                            <option value="libx265">H.265 (libx265)</option>
                            <option value="libvpx-vp9">VP9 (libvpx-vp9)</option>
                        </optgroup>
                        <optgroup data-translate-key-label="gpuCodecsLabel">
                            <option value="h264_nvenc">H.264 (NVIDIA NVENC)</option>
                            <option value="hevc_nvenc">H.265 (NVIDIA NVENC)</option>
                            <option value="h264_qsv">H.264 (Intel QSV)</option>
                            <option value="hevc_qsv">H.265 (Intel QSV)</option>
                            <option value="h264_amf">H.264 (AMD AMF)</option>
                            <option value="hevc_amf">H.265 (AMD AMF)</option>
                        </optgroup>
                        <optgroup data-translate-key-label="specialCodecsLabel">
                            <option value="copy" data-translate-key="copy"></option>
                            <option value="none" data-translate-key="deleteVideo"></option>
                        </optgroup>
                    </select>
                    <p class="text-xs text-gray-500 mt-2" data-translate-key="gpuNotice"></p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="videoBitrate" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="videoBitrateLabel"></label>
                        <input type="number" id="videoBitrate" class="form-input w-full rounded-lg p-2.5" value="15000">
                    </div>
                    <div>
                        <label for="resolutionW" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="widthLabel"></label>
                        <input type="number" id="resolutionW" class="form-input w-full rounded-lg p-2.5" placeholder="1920">
                    </div>
                    <div>
                        <label for="aspectRatio" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="aspectRatioLabel"></label>
                        <select id="aspectRatio" class="form-select w-full rounded-lg p-2.5">
                            <option value="source" data-translate-key="aspectSource"></option>
                            <option value="16:9">16:9</option>
                            <option value="4:3">4:3</option>
                            <option value="1:1" data-translate-key="aspectSquare"></option>
                            <option value="2.35:1" data-translate-key="aspectCinema"></option>
                        </select>
                    </div>
                    <div>
                        <label for="resolutionH" class="block mb-2 text-sm font-medium text-gray-300" data-translate-key="heightLabel"></label>
                        <input type="number" id="resolutionH" class="form-input w-full rounded-lg p-2.5" placeholder="1080">
                    </div>
                </div>

                <!-- Audio Options -->
                <div class="pt-4 mt-4 border-t border-gray-700">
                    <h4 class="text-lg font-semibold mb-3" data-translate-key="audioTracksTitle"></h4>
                    <div id="audioTracksContainer" class="space-y-5"></div>
                    <button id="addAudioTrackBtn" class="mt-4 text-sm bg-blue-600/50 hover:bg-blue-600/80 text-white font-semibold py-2 px-4 rounded-lg w-full transition-colors" data-translate-key="addAudioTrackBtn"></button>
                </div>

                 <!-- Video Filters -->
                <div class="pt-4 mt-4 border-t border-gray-700">
                     <h4 class="text-base font-medium text-gray-300 mb-2" data-translate-key="videoFiltersTitle"></h4>
                     <div class="space-y-2">
                         <label class="flex items-center space-x-3 cursor-pointer">
                             <input type="checkbox" id="deinterlace" class="form-checkbox h-5 w-5 rounded bg-gray-700 border-gray-600 text-blue-600 focus:ring-blue-500">
                             <span class="text-sm text-gray-300" data-translate-key="deinterlaceLabel"></span>
                         </label>
                     </div>
                </div>
            </div>
        </div>

        <!-- Action Button -->
        <div class="flex justify-center pt-4">
            <button id="generateBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-800" data-translate-key="generateBtn"></button>
        </div>

        <!-- Output Section -->
        <div id="outputSection" class="hidden pt-6">
            <h3 class="text-lg font-semibold mb-2" data-translate-key="resultTitle"></h3>
            <!-- Single File Output -->
            <div id="singleFileOutput">
                <div class="relative bg-gray-900 rounded-lg p-4 font-mono text-sm text-green-400 overflow-x-auto">
                    <code id="outputCommand"></code>
                    <button id="copyBtn" class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-1 px-3 rounded-md text-xs" data-translate-key="copyBtn"></button>
                </div>
            </div>
            <!-- Batch Script Output -->
            <div id="batchScriptOutput" class="hidden">
                 <div class="border-b border-gray-700">
                    <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                        <button id="tab-windows" type="button" class="tab-active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Windows (CMD)</button>
                        <button id="tab-linux" type="button" class="tab-inactive whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">Linux/macOS</button>
                    </nav>
                </div>
                <div id="script-windows-content">
                    <div class="relative bg-gray-900 rounded-b-lg p-4 font-mono text-sm text-green-400 overflow-x-auto">
                        <code id="outputScriptWindows"></code>
                        <button id="copyBtnWindows" class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-1 px-3 rounded-md text-xs" data-translate-key="copyBtn"></button>
                    </div>
                </div>
                <div id="script-linux-content" class="hidden">
                    <div class="relative bg-gray-900 rounded-b-lg p-4 font-mono text-sm text-green-400 overflow-x-auto">
                        <code id="outputScriptLinux"></code>
                        <button id="copyBtnLinux" class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-1 px-3 rounded-md text-xs" data-translate-key="copyBtn"></button>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-2" data-translate-key="batchNotice"></p>
            </div>
             <p id="copy-message" class="text-center text-sm text-green-500 mt-2 opacity-0 transition-opacity duration-300" data-translate-key="copyMessage"></p>
        </div>
    </div>

    <script>
        // --- TRANSLATION STRINGS ---
        const uiStrings = {
            mainTitle: { ru: 'FFmpeg Конвертер', uk: 'FFmpeg Конвертер', en: 'FFmpeg Converter' },
            subTitle: { ru: 'Создайте команду для конвертации видео и аудио файлов', uk: 'Створіть команду для конвертації відео та аудіо файлів', en: 'Create a command to convert video and audio files' },
            singleModeLabel: { ru: 'Одиночный файл', uk: 'Одиночний файл', en: 'Single File' },
            batchModeLabel: { ru: 'Пакетная обработка', uk: 'Пакетна обробка', en: 'Batch Processing' },
            filesTitle: { ru: '1. Файлы', uk: '1. Файли', en: '1. Files' },
            inputFileLabel: { ru: 'Исходный файл (полный путь)', uk: 'Вхідний файл (повний шлях)', en: 'Source File (full path)' },
            inputFilePlaceholder: { ru: '"C:\\Users\\Videos\\input.mp4"', uk: '"C:\\Users\\Videos\\input.mp4"', en: '"C:\\Users\\Videos\\input.mp4"' },
            outputFileLabel: { ru: 'Выходной файл (полный путь)', uk: 'Вихідний файл (повний шлях)', en: 'Output File (full path)' },
            outputFilePlaceholder: { ru: '"D:\\Converted\\output.mkv"', uk: '"D:\\Converted\\output.mkv"', en: '"D:\\Converted\\output.mkv"' },
            inputFolderLabel: { ru: 'Папка с файлами', uk: 'Папка з файлами', en: 'Input Folder' },
            outputFolderLabel: { ru: 'Выходная папка', uk: 'Вихідна папка', en: 'Output Folder' },
            fileTypesLabel: { ru: 'Типы файлов (через запятую)', uk: 'Типи файлів (через кому)', en: 'File Types (comma-separated)' },
            outputFormatLabel: { ru: 'Формат выходного файла', uk: 'Формат вихідного файлу', en: 'Output File Format' },
            trimTitle: { ru: 'Обрезка', uk: 'Обрізка', en: 'Trimming' },
            trimStartLabel: { ru: 'Начало', uk: 'Початок', en: 'Start' },
            trimEndLabel: { ru: 'Конец', uk: 'Кінець', en: 'End' },
            trimNotice: { ru: 'Если оставить поля пустыми, видео будет сконвертировано целиком.', uk: 'Якщо залишити поля порожніми, відео буде сконвертовано повністю.', en: 'If fields are left empty, the video will be converted in its entirety.' },
            paramsTitle: { ru: '2. Параметры конвертации', uk: '2. Параметри конвертації', en: '2. Conversion Parameters' },
            videoCodecLabel: { ru: 'Видео кодек', uk: 'Відео кодек', en: 'Video Codec' },
            cpuCodecsLabel: { ru: 'Программные кодеки (CPU)', uk: 'Програмні кодеки (CPU)', en: 'Software Codecs (CPU)' },
            gpuCodecsLabel: { ru: 'Аппаратное ускорение (GPU)', uk: 'Апаратне прискорення (GPU)', en: 'Hardware Acceleration (GPU)' },
            specialCodecsLabel: { ru: 'Специальные', uk: 'Спеціальні', en: 'Special' },
            copy: { ru: 'Копировать (без перекодирования)', uk: 'Копіювати (без перекодування)', en: 'Copy (no re-encoding)' },
            deleteVideo: { ru: 'Удалить видео', uk: 'Видалити відео', en: 'Delete video' },
            gpuNotice: { ru: 'Для аппаратного ускорения требуются совместимая видеокарта и установленные драйверы.', uk: 'Для апаратного прискорення потрібні сумісна відеокарта та встановлені драйвери.', en: 'Hardware acceleration requires a compatible graphics card and installed drivers.' },
            videoBitrateLabel: { ru: 'Видео битрейт (kbps)', uk: 'Відео бітрейт (kbps)', en: 'Video Bitrate (kbps)' },
            widthLabel: { ru: 'Ширина', uk: 'Ширина', en: 'Width' },
            aspectRatioLabel: { ru: 'Соотношение сторон', uk: 'Співвідношення сторін', en: 'Aspect Ratio' },
            aspectSource: { ru: 'Исходное', uk: 'Джерельне', en: 'Source' },
            aspectSquare: { ru: '1:1 (Квадрат)', uk: '1:1 (Квадрат)', en: '1:1 (Square)' },
            aspectCinema: { ru: '2.35:1 (Кино)', uk: '2.35:1 (Кіно)', en: '2.35:1 (Cinema)' },
            heightLabel: { ru: 'Высота', uk: 'Висота', en: 'Height' },
            audioTracksTitle: { ru: 'Аудио дорожки', uk: 'Аудіо доріжки', en: 'Audio Tracks' },
            addAudioTrackBtn: { ru: 'Добавить аудио дорожку', uk: 'Додати аудіо доріжку', en: 'Add Audio Track' },
            videoFiltersTitle: { ru: 'Видео фильтры', uk: 'Відео фільтри', en: 'Video Filters' },
            deinterlaceLabel: { ru: 'Деинтерлейс (yadif)', uk: 'Деінтерлейс (yadif)', en: 'Deinterlace (yadif)' },
            generateBtn: { ru: 'Сгенерировать команду', uk: 'Згенерувати команду', en: 'Generate Command' },
            resultTitle: { ru: '3. Готовая команда', uk: '3. Готова команда', en: '3. Resulting Command' },
            copyBtn: { ru: 'Копировать', uk: 'Копіювати', en: 'Copy' },
            copyMessage: { ru: 'Команда скопирована в буфер обмена!', uk: 'Команду скопійовано в буфер обміну!', en: 'Command copied to clipboard!' },
            batchNotice: { ru: 'Скопируйте команду и вставьте в терминал. Для Windows используйте CMD (не PowerShell).', uk: 'Скопіюйте команду та вставте у термінал. Для Windows використовуйте CMD (не PowerShell).', en: 'Copy the command and paste it into your terminal. For Windows, use CMD (not PowerShell).' },
            fileError: { ru: 'Пожалуйста, укажите все необходимые пути.', uk: 'Будь ласка, вкажіть усі необхідні шляхи.', en: 'Please specify all required paths.' },
            // Dynamic track labels
            outputTrackTitle: { ru: 'Выходная аудио дорожка №', uk: 'Вихідна аудіо доріжка №', en: 'Output Audio Track #' },
            sourceTrackLabel: { ru: 'Исходная дорожка', uk: 'Вхідна доріжка', en: 'Source Track' },
            audioCodecLabel: { ru: 'Аудио кодек', uk: 'Аудіо кодек', en: 'Audio Codec' },
            deleteAudio: { ru: 'Удалить аудио', uk: 'Видалити аудіо', en: 'Delete audio' },
            channelsLabel: { ru: 'Каналы', uk: 'Канали', en: 'Channels' },
            stereoLabel: { ru: 'Stereo 2.0', uk: 'Stereo 2.0', en: 'Stereo 2.0' },
            monoLabel: { ru: 'Mono', uk: 'Mono', en: 'Mono' },
            surroundLabel: { ru: '5.1 Surround', uk: '5.1 Surround', en: '5.1 Surround' },
            audioBitrateLabel: { ru: 'Битрейт (kbps)', uk: 'Бітрейт (kbps)', en: 'Bitrate (kbps)' },
            langLabel: { ru: 'Язык дорожки', uk: 'Мова доріжки', en: 'Track Language' },
            loudnormLabel: { ru: 'Нормализация громкости (loudnorm)', uk: 'Нормалізація гучності (loudnorm)', en: 'Loudness Normalization (loudnorm)' },
        };

        const languages = [
            { code: 'rus', name: 'Russian' }, { code: 'ukr', name: 'Ukrainian' }, { code: 'eng', name: 'English' }, { code: 'pol', name: 'Polish' },
            { code: 'separator', name: '──────────' },
            { code: 'aar', name: 'Afar' }, { code: 'abk', name: 'Abkhazian' }, { code: 'ave', name: 'Avestan' }, { code: 'afr', name: 'Afrikaans' }, { code: 'aka', name: 'Akan' }, { code: 'amh', name: 'Amharic' }, { code: 'arg', name: 'Aragonese' }, { code: 'ara', name: 'Arabic' }, { code: 'asm', name: 'Assamese' }, { code: 'ava', name: 'Avaric' }, { code: 'aym', name: 'Aymara' }, { code: 'aze', name: 'Azerbaijani' }, { code: 'bak', name: 'Bashkir' }, { code: 'bel', name: 'Belarusian' }, { code: 'bul', name: 'Bulgarian' }, { code: 'bih', name: 'Bihari languages' }, { code: 'bis', name: 'Bislama' }, { code: 'bam', name: 'Bambara' }, { code: 'ben', name: 'Bengali' }, { code: 'bod', name: 'Tibetan' }, { code: 'bre', name: 'Breton' }, { code: 'bos', name: 'Bosnian' }, { code: 'cat', name: 'Catalan; Valencian' }, { code: 'che', name: 'Chechen' }, { code: 'cha', name: 'Chamorro' }, { code: 'cos', name: 'Corsican' }, { code: 'cre', name: 'Cree' }, { code: 'ces', name: 'Czech' }, { code: 'chu', name: 'Church Slavic' }, { code: 'chv', name: 'Chuvash' }, { code: 'cym', name: 'Welsh' }, { code: 'dan', name: 'Danish' }, { code: 'deu', name: 'German' }, { code: 'div', name: 'Divehi; Dhivehi; Maldivian' }, { code: 'dzo', name: 'Dzongkha' }, { code: 'ewe', name: 'Ewe' }, { code: 'ell', name: 'Greek, Modern (1453-)' }, { code: 'epo', name: 'Esperanto' }, { code: 'spa', name: 'Spanish; Castilian' }, { code: 'est', name: 'Estonian' }, { code: 'eus', name: 'Basque' }, { code: 'fas', name: 'Persian' }, { code: 'ful', name: 'Fulah' }, { code: 'fin', name: 'Finnish' }, { code: 'fij', name: 'Fijian' }, { code: 'fao', name: 'Faroese' }, { code: 'fra', name: 'French' }, { code: 'fry', name: 'Western Frisian' }, { code: 'gle', name: 'Irish' }, { code: 'gla', name: 'Gaelic; Scottish Gaelic' }, { code: 'glg', name: 'Galician' }, { code: 'grn', name: 'Guarani' }, { code: 'guj', name: 'Gujarati' }, { code: 'glv', name: 'Manx' }, { code: 'hau', name: 'Hausa' }, { code: 'heb', name: 'Hebrew' }, { code: 'hin', name: 'Hindi' }, { code: 'hmo', name: 'Hiri Motu' }, { code: 'hrv', name: 'Croatian' }, { code: 'hat', name: 'Haitian; Haitian Creole' }, { code: 'hun', name: 'Hungarian' }, { code: 'hye', name: 'Armenian' }, { code: 'her', name: 'Herero' }, { code: 'ina', name: 'Interlingua (International Auxiliary Language Association)' }, { code: 'ind', name: 'Indonesian' }, { code: 'ile', name: 'Interlingue; Occidental' }, { code: 'ibo', name: 'Igbo' }, { code: 'iii', name: 'Sichuan Yi; Nuosu' }, { code: 'ipk', name: 'Inupiaq' }, { code: 'ido', name: 'Ido' }, { code: 'isl', name: 'Icelandic' }, { code: 'ita', name: 'Italian' }, { code: 'iku', name: 'Inuktitut' }, { code: 'jpn', name: 'Japanese' }, { code: 'jav', name: 'Javanese' }, { code: 'kat', name: 'Georgian' }, { code: 'kon', name: 'Kongo' }, { code: 'kik', name: 'Kikuyu; Gikuyu' }, { code: 'kua', name: 'Kuanyama; Kwanyama' }, { code: 'kaz', name: 'Kazakh' }, { code: 'kal', name: 'Kalaallisut; Greenlandic' }, { code: 'khm', name: 'Central Khmer' }, { code: 'kan', name: 'Kannada' }, { code: 'kor', name: 'Korean' }, { code: 'kau', name: 'Kanuri' }, { code: 'kas', name: 'Kashmiri' }, { code: 'kur', name: 'Kurdish' }, { code: 'kom', name: 'Komi' }, { code: 'cor', name: 'Cornish' }, { code: 'kir', name: 'Kirghiz; Kyrgyz' }, { code: 'lat', name: 'Latin' }, { code: 'ltz', name: 'Luxembourgish; Letzeburgesch' }, { code: 'lug', name: 'Ganda' }, { code: 'lim', name: 'Limburgan; Limburger; Limburgish' }, { code: 'lin', name: 'Lingala' }, { code: 'lao', name: 'Lao' }, { code: 'lit', name: 'Lithuanian' }, { code: 'lub', name: 'Luba-Katanga' }, { code: 'lav', name: 'Latvian' }, { code: 'mlg', name: 'Malagasy' }, { code: 'mah', name: 'Marshallese' }, { code: 'mri', name: 'Maori' }, { code: 'mkd', name: 'Macedonian' }, { code: 'mal', name: 'Malayalam' }, { code: 'mon', name: 'Mongolian' }, { code: 'mar', name: 'Marathi' }, { code: 'msa', name: 'Malay' }, { code: 'mlt', name: 'Maltese' }, { code: 'mya', name: 'Burmese' }, { code: 'nau', name: 'Nauru' }, { code: 'nob', name: 'Bokmål, Norwegian; Norwegian Bokmål' }, { code: 'nde', name: 'Ndebele, North; North Ndebele' }, { code: 'nep', name: 'Nepali' }, { code: 'ndo', name: 'Ndonga' }, { code: 'nld', name: 'Dutch; Flemish' }, { code: 'nno', name: 'Norwegian Nynorsk; Nynorsk, Norwegian' }, { code: 'nor', name: 'Norwegian' }, { code: 'nbl', name: 'Ndebele, South; South Ndebele' }, { code: 'nav', name: 'Navajo; Navaho' }, { code: 'nya', name: 'Chichewa; Chewa; Nyanja' }, { code: 'oci', name: 'Occitan (post 1500)' }, { code: 'oji', name: 'Ojibwa' }, { code: 'orm', name: 'Oromo' }, { code: 'ori', name: 'Oriya' }, { code: 'oss', name: 'Ossetian; Ossetic' }, { code: 'pan', name: 'Panjabi; Punjabi' }, { code: 'pli', name: 'Pali' }, { code: 'pus', name: 'Pushto; Pashto' }, { code: 'por', name: 'Portuguese' }, { code: 'que', name: 'Quechua' }, { code: 'roh', name: 'Romansh' }, { code: 'run', name: 'Rundi' }, { code: 'ron', name: 'Romanian; Moldavian; Moldovan' }, { code: 'kin', name: 'Kinyarwanda' }, { code: 'san', name: 'Sanskrit' }, { code: 'srd', name: 'Sardinian' }, { code: 'snd', name: 'Sindhi' }, { code: 'sme', name: 'Northern Sami' }, { code: 'sag', name: 'Sango' }, { code: 'sin', name: 'Sinhala; Sinhalese' }, { code: 'slk', name: 'Slovak' }, { code: 'slv', name: 'Slovenian' }, { code: 'smo', name: 'Samoan' }, { code: 'sna', name: 'Shona' }, { code: 'som', name: 'Somali' }, { code: 'sqi', name: 'Albanian' }, { code: 'srp', name: 'Serbian' }, { code: 'ssw', name: 'Swati' }, { code: 'sot', name: 'Sotho, Southern' }, { code: 'sun', name: 'Sundanese' }, { code: 'swe', name: 'Swedish' }, { code: 'swa', name: 'Swahili' }, { code: 'tam', name: 'Tamil' }, { code: 'tel', name: 'Telugu' }, { code: 'tgk', name: 'Tajik' }, { code: 'tha', name: 'Thai' }, { code: 'tir', name: 'Tigrinya' }, { code: 'tuk', name: 'Turkmen' }, { code: 'tgl', name: 'Tagalog' }, { code: 'tsn', name: 'Tswana' }, { code: 'ton', name: 'Tonga (Tonga Islands)' }, { code: 'tur', name: 'Turkish' }, { code: 'tso', name: 'Tsonga' }, { code: 'tat', name: 'Tatar' }, { code: 'twi', name: 'Twi' }, { code: 'tah', name: 'Tahitian' }, { code: 'uig', name: 'Uighur; Uyghur' }, { code: 'urd', name: 'Urdu' }, { code: 'uzb', name: 'Uzbek' }, { code: 'ven', name: 'Venda' }, { code: 'vie', name: 'Vietnamese' }, { code: 'vol', name: 'Volapük' }, { code: 'wln', name: 'Walloon' }, { code: 'wol', name: 'Wolof' }, { code: 'xho', name: 'Xhosa' }, { code: 'yid', name: 'Yiddish' }, { code: 'yor', name: 'Yoruba' }, { code: 'zha', name: 'Zhuang; Chuang' }, { code: 'zho', name: 'Chinese' }, { code: 'zul', name: 'Zulu' }
        ];

        // --- DOM ELEMENTS ---
        const modeToggleEl = document.getElementById('mode-toggle');
        const singleFileModeEl = document.getElementById('singleFileMode');
        const batchModeEl = document.getElementById('batchMode');
        const trimmingSectionEl = document.getElementById('trimmingSection');
        const singleFileOutputEl = document.getElementById('singleFileOutput');
        const batchScriptOutputEl = document.getElementById('batchScriptOutput');
        const inputFileEl = document.getElementById('inputFile');
        const outputFileEl = document.getElementById('outputFile');
        const inputFolderEl = document.getElementById('inputFolder');
        const outputFolderEl = document.getElementById('outputFolder');
        const fileTypesEl = document.getElementById('fileTypes');
        const outputFormatEl = document.getElementById('outputFormat');
        const trimStartEl = document.getElementById('trimStart');
        const trimEndEl = document.getElementById('trimEnd');
        const videoCodecEl = document.getElementById('videoCodec');
        const videoBitrateEl = document.getElementById('videoBitrate');
        const resolutionWEl = document.getElementById('resolutionW');
        const resolutionHEl = document.getElementById('resolutionH');
        const aspectRatioEl = document.getElementById('aspectRatio');
        const deinterlaceEl = document.getElementById('deinterlace');
        const generateBtn = document.getElementById('generateBtn');
        const outputSection = document.getElementById('outputSection');
        const outputCommandEl = document.getElementById('outputCommand');
        const outputScriptWindowsEl = document.getElementById('outputScriptWindows');
        const outputScriptLinuxEl = document.getElementById('outputScriptLinux');
        const copyBtn = document.getElementById('copyBtn');
        const copyBtnWindowsEl = document.getElementById('copyBtnWindows');
        const copyBtnLinuxEl = document.getElementById('copyBtnLinux');
        const copyMessage = document.getElementById('copy-message');
        const audioTracksContainer = document.getElementById('audioTracksContainer');
        const addAudioTrackBtn = document.getElementById('addAudioTrackBtn');
        const languageSelectorEl = document.getElementById('languageSelector');
        const tabWindowsEl = document.getElementById('tab-windows');
        const tabLinuxEl = document.getElementById('tab-linux');
        const scriptWindowsContentEl = document.getElementById('script-windows-content');
        const scriptLinuxContentEl = document.getElementById('script-linux-content');

        let audioTrackIdCounter = 0;
        let currentLang = 'ru';
        let isBatchMode = false;

        // --- FUNCTIONS ---
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-translate-key]').forEach(el => uiStrings[el.dataset.translateKey] && (el.textContent = uiStrings[el.dataset.translateKey][lang]));
            document.querySelectorAll('[data-translate-key-placeholder]').forEach(el => uiStrings[el.dataset.translateKeyPlaceholder] && (el.placeholder = uiStrings[el.dataset.translateKeyPlaceholder][lang]));
            document.querySelectorAll('optgroup[data-translate-key-label]').forEach(el => uiStrings[el.dataset.translateKeyLabel] && (el.label = uiStrings[el.dataset.translateKeyLabel][lang]));
            rebuildAudioTracks();
        }
        
        function rebuildAudioTracks() {
            const currentTracksData = [];
            audioTracksContainer.querySelectorAll('.audio-track-group').forEach(trackEl => {
                currentTracksData.push({
                    sourceIndex: trackEl.querySelector('.audio-index').value,
                    codec: trackEl.querySelector('.audio-codec').value,
                    channels: trackEl.querySelector('.audio-channels').value,
                    bitrate: trackEl.querySelector('.audio-bitrate').value,
                    lang: trackEl.querySelector('.audio-lang').value,
                    loudnorm: trackEl.querySelector('.audio-loudnorm').checked,
                });
            });
            audioTracksContainer.innerHTML = '';
            audioTrackIdCounter = 0;
            if (currentTracksData.length === 0) {
                audioTracksContainer.appendChild(createAudioTrackElement(true));
            } else {
                currentTracksData.forEach((data, index) => audioTracksContainer.appendChild(createAudioTrackElement(index === 0, data)));
            }
            updateAudioTrackTitles();
        }

        function updateAudioTrackTitles() {
            audioTracksContainer.querySelectorAll('.audio-track-group').forEach((trackEl, index) => {
                const titleEl = trackEl.querySelector('.track-title');
                if (titleEl) titleEl.textContent = `${uiStrings.outputTrackTitle[currentLang]}${index + 1}`;
            });
        }

        function createAudioTrackElement(isFirst = false, existingData = null) {
            const trackId = audioTrackIdCounter++;
            const trackDiv = document.createElement('div');
            trackDiv.className = 'audio-track-group bg-gray-800/50 p-4 rounded-lg space-y-3 relative';
            trackDiv.dataset.id = trackId;

            const langOptions = languages.map(lang => {
                if (lang.code === 'separator') return `<option disabled>${lang.name}</option>`;
                const selected = existingData ? (existingData.lang === lang.code ? 'selected' : '') : (isFirst && lang.code === 'rus' ? 'selected' : '');
                return `<option value="${lang.code}" ${selected}>${lang.name}</option>`;
            }).join('');

            let sourceTrackOptions = '';
            const defaultSourceIndex = existingData ? existingData.sourceIndex : audioTracksContainer.children.length + 1;
            for (let i = 1; i <= 16; i++) {
                sourceTrackOptions += `<option value="${i}" ${i == defaultSourceIndex ? 'selected' : ''}>${i}</option>`;
            }

            trackDiv.innerHTML = `
                <h5 class="track-title text-base font-semibold text-blue-400 mb-2"></h5>
                <div class="grid grid-cols-2 gap-x-4 gap-y-3">
                    <div><label for="audio-index-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">${uiStrings.sourceTrackLabel[currentLang]}</label><select id="audio-index-${trackId}" class="audio-index form-select w-full rounded-md p-2 text-sm">${sourceTrackOptions}</select></div>
                    <div><label for="audio-codec-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">${uiStrings.audioCodecLabel[currentLang]}</label><select id="audio-codec-${trackId}" class="audio-codec form-select w-full rounded-md p-2 text-sm"><option value="aac" ${existingData?.codec === 'aac' ? 'selected' : ''}>AAC</option><option value="ac3" ${existingData?.codec === 'ac3' ? 'selected' : ''}>AC3</option><option value="libmp3lame" ${existingData ? (existingData.codec === 'libmp3lame' ? 'selected' : '') : 'selected'}>MP3</option><option value="opus" ${existingData?.codec === 'opus' ? 'selected' : ''}>Opus</option><option value="copy" ${existingData?.codec === 'copy' ? 'selected' : ''}>${uiStrings.copy[currentLang]}</option><option value="none" ${existingData?.codec === 'none' ? 'selected' : ''}>${uiStrings.deleteAudio[currentLang]}</option></select></div>
                    <div><label for="audio-channels-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">${uiStrings.channelsLabel[currentLang]}</label><select id="audio-channels-${trackId}" class="audio-channels form-select w-full rounded-md p-2 text-sm"><option value="2" ${existingData ? (existingData.channels === '2' ? 'selected' : '') : 'selected'}>${uiStrings.stereoLabel[currentLang]}</option><option value="1" ${existingData?.channels === '1' ? 'selected' : ''}>${uiStrings.monoLabel[currentLang]}</option><option value="6" ${existingData?.channels === '6' ? 'selected' : ''}>${uiStrings.surroundLabel[currentLang]}</option></select></div>
                    <div><label for="audio-bitrate-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">${uiStrings.audioBitrateLabel[currentLang]}</label><input type="number" id="audio-bitrate-${trackId}" value="${existingData ? existingData.bitrate : '320'}" class="audio-bitrate form-input w-full rounded-md p-2 text-sm"></div>
                    <div class="col-span-2"><label for="audio-lang-${trackId}" class="block mb-1 text-xs font-medium text-gray-400">${uiStrings.langLabel[currentLang]}</label><select id="audio-lang-${trackId}" class="audio-lang form-select w-full rounded-md p-2 text-sm">${langOptions}</select></div>
                    <div class="col-span-2"><label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" id="audio-loudnorm-${trackId}" class="audio-loudnorm form-checkbox h-4 w-4 rounded" ${existingData?.loudnorm ? 'checked' : ''}><span class="text-sm text-gray-300">${uiStrings.loudnormLabel[currentLang]}</span></label></div>
                </div>
                ${!isFirst ? `<button class="remove-track-btn absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-xs">&times;</button>` : ''}
            `;
            if (!isFirst) trackDiv.querySelector('.remove-track-btn').addEventListener('click', () => { trackDiv.remove(); updateAudioTrackTitles(); });
            return trackDiv;
        }

        function getParamsString() {
            let mapParams = '';
            let metadataParams = '';
            const videoCodec = videoCodecEl.value;
            if (videoCodec !== 'none') {
                mapParams += ' -map 0:v:0?';
                metadataParams += ` -c:v:0 ${videoCodec}`;
                if (videoCodec !== 'copy') {
                    const videoBitrate = videoBitrateEl.value.trim();
                    if (videoBitrate) metadataParams += ` -b:v:0 ${videoBitrate}k`;
                    if (videoCodec === 'libx264') metadataParams += ' -profile:v:0 high -pix_fmt yuv420p -level 4.1 -preset medium';
                    else if (videoCodec === 'libx265') metadataParams += ' -preset medium';
                }
                const aspectRatio = aspectRatioEl.value;
                if (aspectRatio !== 'source') metadataParams += ` -aspect:v:0 ${aspectRatio}`;
            } else {
                metadataParams += ' -vn';
            }

            const audioTrackElements = audioTracksContainer.querySelectorAll('.audio-track-group');
            let audioOutputIndex = 0;
            audioTrackElements.forEach(trackEl => {
                const audioIndexFromUI = parseInt(trackEl.querySelector('.audio-index').value, 10);
                if (isNaN(audioIndexFromUI) || audioIndexFromUI < 1) return;
                const audioIndexForCommand = audioIndexFromUI - 1;
                const audioCodec = trackEl.querySelector('.audio-codec').value;
                if (audioCodec === 'none') return;
                mapParams += ` -map 0:a:${audioIndexForCommand}?`;
                const audioChannels = trackEl.querySelector('.audio-channels').value;
                const audioBitrate = trackEl.querySelector('.audio-bitrate').value.trim();
                const audioLang = trackEl.querySelector('.audio-lang').value;
                const loudnormChecked = trackEl.querySelector('.audio-loudnorm').checked;
                metadataParams += ` -c:a:${audioOutputIndex} ${audioCodec}`;
                if (audioCodec !== 'copy') {
                    metadataParams += ` -ac:a:${audioOutputIndex} ${audioChannels}`;
                    if (audioBitrate) metadataParams += ` -b:a:${audioOutputIndex} ${audioBitrate}k`;
                }
                if (audioLang) metadataParams += ` -metadata:s:a:${audioOutputIndex} language=${audioLang}`;
                if (loudnormChecked && audioCodec !== 'copy') metadataParams += ` -af:a:${audioOutputIndex} loudnorm`;
                audioOutputIndex++;
            });
            if (audioOutputIndex === 0) metadataParams += ' -an';
            
            const videoFilters = [];
            if (videoCodec !== 'copy' && videoCodec !== 'none') {
                if (deinterlaceEl.checked) videoFilters.push('yadif');
                const width = resolutionWEl.value.trim();
                const height = resolutionHEl.value.trim();
                if (width || height) videoFilters.push(`scale=${width || -2}:${height || -2}`);
            }
            if (videoFilters.length > 0) metadataParams += ` -vf "${videoFilters.join(',')}"`;
            metadataParams += ' -map 0:s? -c:s copy -y';
            return { mapParams, metadataParams };
        }

        // --- EVENT LISTENERS ---
        modeToggleEl.addEventListener('change', (e) => {
            isBatchMode = e.target.checked;
            singleFileModeEl.classList.toggle('hidden', isBatchMode);
            batchModeEl.classList.toggle('hidden', !isBatchMode);
            trimmingSectionEl.classList.toggle('hidden', isBatchMode);
            outputSection.classList.add('hidden');
        });

        addAudioTrackBtn.addEventListener('click', () => {
            audioTracksContainer.appendChild(createAudioTrackElement());
            updateAudioTrackTitles();
        });

        document.addEventListener('DOMContentLoaded', () => setLanguage('ru'));
        languageSelectorEl.addEventListener('change', (e) => setLanguage(e.target.value));

        generateBtn.addEventListener('click', () => {
            const { mapParams, metadataParams } = getParamsString();
            
            if (isBatchMode) {
                singleFileOutputEl.classList.add('hidden');
                batchScriptOutputEl.classList.remove('hidden');
                const inputFolder = inputFolderEl.value.trim();
                const outputFolder = outputFolderEl.value.trim();
                const fileTypes = fileTypesEl.value.trim().split(',').map(t => t.trim());
                const outputFormat = outputFormatEl.value.trim();
                if (!inputFolder || !outputFolder || fileTypes.length === 0 || !outputFormat) {
                    alert(uiStrings.fileError[currentLang]);
                    return;
                }
                const winFileTypes = fileTypes.join(' ');
                const winCommand = `for %f in (${winFileTypes}) do ffmpeg -i "${inputFolder}\\%f" ${mapParams} ${metadataParams} "${outputFolder}\\%~nf.${outputFormat}"`;
                outputScriptWindowsEl.textContent = winCommand;

                const linuxFileTypes = fileTypes.map(ft => ft.replace('*.', '')).join(',');
                const linuxCommand = `for f in ${inputFolder}/*.${linuxFileTypes.length > 1 ? `{${linuxFileTypes}}` : linuxFileTypes}; do [ -f "$f" ] && ffmpeg -i "$f" ${mapParams} ${metadataParams} "${outputFolder}/$(basename "\${f%.*}").${outputFormat}"; done`;
                outputScriptLinuxEl.textContent = linuxCommand;

            } else {
                singleFileOutputEl.classList.remove('hidden');
                batchScriptOutputEl.classList.add('hidden');
                const inputFile = inputFileEl.value.trim();
                const outputFile = outputFileEl.value.trim();
                if (!inputFile || !outputFile) {
                    alert(uiStrings.fileError[currentLang]);
                    return;
                }
                let command = `ffmpeg`;
                const trimStart = trimStartEl.value.trim();
                if (trimStart) command += ` -ss ${trimStart}`;
                command += ` -i ${inputFile}`;
                const trimEnd = trimEndEl.value.trim();
                if (trimEnd) command += ` -to ${trimEnd}`;
                command += mapParams + metadataParams;
                command += ` ${outputFile}`;
                outputCommandEl.textContent = command;
            }
            outputSection.classList.remove('hidden');
        });

        function copyToClipboard(text) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            copyMessage.style.opacity = '1';
            setTimeout(() => { copyMessage.style.opacity = '0'; }, 2000);
        }

        copyBtn.addEventListener('click', () => copyToClipboard(outputCommandEl.textContent));
        copyBtnWindowsEl.addEventListener('click', () => copyToClipboard(outputScriptWindowsEl.textContent));
        copyBtnLinuxEl.addEventListener('click', () => copyToClipboard(outputScriptLinuxEl.textContent));

        tabWindowsEl.addEventListener('click', () => {
            tabWindowsEl.classList.add('tab-active'); tabWindowsEl.classList.remove('tab-inactive');
            tabLinuxEl.classList.add('tab-inactive'); tabLinuxEl.classList.remove('tab-active');
            scriptWindowsContentEl.classList.remove('hidden'); scriptLinuxContentEl.classList.add('hidden');
        });

        tabLinuxEl.addEventListener('click', () => {
            tabLinuxEl.classList.add('tab-active'); tabLinuxEl.classList.remove('tab-inactive');
            tabWindowsEl.classList.add('tab-inactive'); tabWindowsEl.classList.remove('tab-active');
            scriptLinuxContentEl.classList.remove('hidden'); scriptWindowsContentEl.classList.add('hidden');
        });
    </script>
</body>
</html>
